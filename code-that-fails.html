<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Code that Fails | Agile Data Science with R</title>
  <meta name="description" content="A workflow for doing data science in the R language, using Agile principles." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Code that Fails | Agile Data Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A workflow for doing data science in the R language, using Agile principles." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Code that Fails | Agile Data Science with R" />
  
  <meta name="twitter:description" content="A workflow for doing data science in the R language, using Agile principles." />
  

<meta name="author" content="Edwin Thoen" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="code-organsation.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Working without a Workflow</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-this-text-is-about"><i class="fa fa-check"></i><b>1.1</b> What this Text is About</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#writing-out-loud"><i class="fa fa-check"></i><b>1.2</b> Writing out Loud</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#intended-audience"><i class="fa fa-check"></i><b>1.3</b> Intended Audience</a></li>
</ul></li>
<li class="part"><span><b>I Agile Data Science…</b></span></li>
<li class="chapter" data-level="2" data-path="agile-in-a-nutshell.html"><a href="agile-in-a-nutshell.html"><i class="fa fa-check"></i><b>2</b> Agile in a Nutshell</a><ul>
<li class="chapter" data-level="2.1" data-path="agile-in-a-nutshell.html"><a href="agile-in-a-nutshell.html#the-origins-of-agile"><i class="fa fa-check"></i><b>2.1</b> The Origins of Agile</a></li>
<li class="chapter" data-level="2.2" data-path="agile-in-a-nutshell.html"><a href="agile-in-a-nutshell.html#the-manifesto"><i class="fa fa-check"></i><b>2.2</b> The Manifesto</a></li>
<li class="chapter" data-level="2.3" data-path="agile-in-a-nutshell.html"><a href="agile-in-a-nutshell.html#the-twelve-principles"><i class="fa fa-check"></i><b>2.3</b> The Twelve Principles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="agile-methods.html"><a href="agile-methods.html"><i class="fa fa-check"></i><b>3</b> Agile Methods</a><ul>
<li class="chapter" data-level="3.1" data-path="agile-methods.html"><a href="agile-methods.html#scrum"><i class="fa fa-check"></i><b>3.1</b> Scrum</a><ul>
<li class="chapter" data-level="3.1.1" data-path="agile-methods.html"><a href="agile-methods.html#roles"><i class="fa fa-check"></i><b>3.1.1</b> Roles</a></li>
<li class="chapter" data-level="3.1.2" data-path="agile-methods.html"><a href="agile-methods.html#ceremonies"><i class="fa fa-check"></i><b>3.1.2</b> Ceremonies</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="agile-methods.html"><a href="agile-methods.html#kanban"><i class="fa fa-check"></i><b>3.2</b> Kanban</a></li>
<li class="chapter" data-level="3.3" data-path="agile-methods.html"><a href="agile-methods.html#scrum-vs-kanban"><i class="fa fa-check"></i><b>3.3</b> Scrum vs Kanban</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="agile-data-science.html"><a href="agile-data-science.html"><i class="fa fa-check"></i><b>4</b> Agile Data Science</a><ul>
<li class="chapter" data-level="4.1" data-path="agile-data-science.html"><a href="agile-data-science.html#data-science-waterfall"><i class="fa fa-check"></i><b>4.1</b> Data Science Waterfall</a></li>
<li class="chapter" data-level="4.2" data-path="agile-data-science.html"><a href="agile-data-science.html#the-twelve-principle-in-the-data-science-context"><i class="fa fa-check"></i><b>4.2</b> The Twelve Principle in the Data Science Context</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html"><i class="fa fa-check"></i><b>5</b> A Methodology for Agile Machine Learning</a><ul>
<li class="chapter" data-level="5.1" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#linear-and-circular-tasks"><i class="fa fa-check"></i><b>5.1</b> Linear and Circular Tasks</a></li>
<li class="chapter" data-level="5.2" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#a-two-way-workflow-for-development"><i class="fa fa-check"></i><b>5.2</b> A Two-Way Workflow for Development</a></li>
<li class="chapter" data-level="5.3" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#user-stories"><i class="fa fa-check"></i><b>5.3</b> User Stories</a></li>
<li class="chapter" data-level="5.4" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#using-kanban-for-data-science"><i class="fa fa-check"></i><b>5.4</b> Using Kanban for Data Science</a></li>
<li class="chapter" data-level="5.5" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#scoping-tasks"><i class="fa fa-check"></i><b>5.5</b> Scoping Tasks</a></li>
<li class="chapter" data-level="5.6" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#the-product-owner-role"><i class="fa fa-check"></i><b>5.6</b> The Product Owner Role</a></li>
<li class="chapter" data-level="5.7" data-path="a-methodology-for-agile-machine-learning.html"><a href="a-methodology-for-agile-machine-learning.html#monitoring-the-process"><i class="fa fa-check"></i><b>5.7</b> Monitoring the Process</a></li>
</ul></li>
<li class="part"><span><b>II …with R</b></span></li>
<li class="chapter" data-level="6" data-path="code-organsation.html"><a href="code-organsation.html"><i class="fa fa-check"></i><b>6</b> Code Organsation</a><ul>
<li class="chapter" data-level="6.1" data-path="code-organsation.html"><a href="code-organsation.html#using-r-packages"><i class="fa fa-check"></i><b>6.1</b> Using R Packages</a><ul>
<li class="chapter" data-level="6.1.1" data-path="code-organsation.html"><a href="code-organsation.html#explorative-research"><i class="fa fa-check"></i><b>6.1.1</b> Explorative Research</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="code-organsation.html"><a href="code-organsation.html#further-reading"><i class="fa fa-check"></i><b>6.2</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="code-that-fails.html"><a href="code-that-fails.html"><i class="fa fa-check"></i><b>7</b> Code that Fails</a><ul>
<li class="chapter" data-level="7.1" data-path="code-that-fails.html"><a href="code-that-fails.html#assumptions-to-your-data"><i class="fa fa-check"></i><b>7.1</b> Assumptions to your Data</a><ul>
<li class="chapter" data-level="7.1.1" data-path="code-that-fails.html"><a href="code-that-fails.html#type-checking"><i class="fa fa-check"></i><b>7.1.1</b> Type Checking</a></li>
<li class="chapter" data-level="7.1.2" data-path="code-that-fails.html"><a href="code-that-fails.html#column-validation"><i class="fa fa-check"></i><b>7.1.2</b> Column Validation</a></li>
<li class="chapter" data-level="7.1.3" data-path="code-that-fails.html"><a href="code-that-fails.html#data-validation"><i class="fa fa-check"></i><b>7.1.3</b> Data Validation</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="code-that-fails.html"><a href="code-that-fails.html#unit-testing"><i class="fa fa-check"></i><b>7.2</b> Unit Testing</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Agile Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="code-that-fails" class="section level1">
<h1><span class="header-section-number">7</span> Code that Fails</h1>
<p>Your code will fail. Not once, not twice, but hundreds, thousands of times in the course of a large data science project. Everybody’s code fails, many times. Your code, my code, Hadley Wickham’s code. Not because we are bad at what we do, but because it is not possible to foresee all the possible ways the code will be used or all the possible data inputs that the code will run against at the moment we write it. Getting better at programming does not mean you will write fault-free code (although you will make fewer errors as you grow more experienced), but writing code that fails fast and informatively.
Writing such code means that you will spent more time developing than with the <em>random walk</em> method described in the previous chapter. This is an investment that will pay off big time as your project grows in complexity.</p>
<p>But before we look into how to write code that fails fast and informative, why is this important for Agile Data Science? High quality code is part of the twelve principles, but this is a means to an end. The essence of Agile is continuous delivery. Updating and shipping your product everytime you made progress can only be done when your code is adjustable. As the project advances, the end-to-end product will grow in complexity. Sooner rather than later it will reach a point in which you cannot have a full overview of all the aspects of the product anymore. When introducing a new feature you want to make sure all the other elements in the code base keep doing what they were designed for. If not, you want to be instructed clearly what is going wrong so you can either adjust the newly introduced feature or modify the existing elements so it works with the new feature. If everytime you want to make a change the whole thing comes tumbling done without informing you what goes wrong, you cannot achieve the objective of fast, continuous delivery.</p>
<div id="assumptions-to-your-data" class="section level2">
<h2><span class="header-section-number">7.1</span> Assumptions to your Data</h2>
<p>Automation means not calling the functions yourself anymore. You just flip the switch and the whole thing is set in motion. This means that you are no longer get the inmediate feedback you are used to when calling the functions yourself. When something goes wrong the whole thing just breaks with an error message. When you are lucky the error message is informative and you are quick to find the bug. When you are not, you may be confronted with <code>object of type 'closure' is not subsettable</code>, you may have grumpy afternoon ahead. Best to not depend on luck, but make sure you will always get a proper indication what went wrong.</p>
<div id="type-checking" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Type Checking</h3>
<p>Most languages using functional programming are strongly typed. This means that for every argument that a function takes, its datatype is specified at function creation, as well as the datatype that the output takes. When the function is than called it is first checked if the data on which it is called is of the correct type, or at least can be forced to the specified type. If not, it will break inmediately and will tell the user why. R is weakly typed, the data type of the function arguments are not specified. When a function is called it just has a go on the objects that are fed to it. The function only breaks when somewhere in the body another function gets called with an invalid data type. Take the following for instance:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">add_two_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="kw">print</span>(<span class="st">&quot;Reaching this&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="kw">print</span>(<span class="st">&quot;and this&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="kw">print</span>(<span class="st">&quot;Doing some random other stuff&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">}</a></code></pre></div>
<p>Now, what will happen if we accidently call it on a string? It will only break when we hit the <code>+</code> operator, all the code before it runs. The error message it gives us, is not so informative that we inmediately figure out what goes wrong.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">add_two_numbers</span>(<span class="dv">42</span>, <span class="st">&quot;MacGyver&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Reaching this&quot;
## [1] &quot;and this&quot;
## [1] &quot;Doing some random other stuff&quot;</code></pre>
<pre><code>## Error in x + y: non-numeric argument to binary operator</code></pre>
<p>Pfff, what is a binary operator again? When this functions is part of a framework in which higher order functions call lower order functions you may be up for an hour or two of sifting through your code to locate the bug. Fortunately type checking is very easily add to a function by asserting all argument data types in <code>stopifnot</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">add_two_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x), <span class="kw">is.numeric</span>(y))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="kw">print</span>(<span class="st">&quot;Reaching this&quot;</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="kw">print</span>(<span class="st">&quot;and this&quot;</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="kw">print</span>(<span class="st">&quot;Doing some random other stuff&quot;</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="kw">add_two_numbers</span>(<span class="dv">42</span>, <span class="st">&quot;MacGyver&quot;</span>)</a></code></pre></div>
<pre><code>## Error in add_two_numbers(42, &quot;MacGyver&quot;): is.numeric(y) is not TRUE</code></pre>
<p>We are now specifically informed, which argument does not meet the assumptions and in what the name of the subfunction is.</p>
</div>
<div id="column-validation" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Column Validation</h3>
<p>Central to most data products will be the modification of data frames. Probably most functions you’ll create are very specific to your project and will be called only once. For these cases you want to save yourself the overhead of making each function completely generic by parametrising the column names that are used. Say you want to add the log of the target to the data frame and you create the following function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">add_log_target &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="kw">stopifnot</span>(<span class="kw">is.data.frame</span>(x))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  x<span class="op">$</span>target_log &lt;-<span class="st"> </span><span class="kw">log</span>(x<span class="op">$</span>target)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  x</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">}</a></code></pre></div>
<p>Now what if <code>target</code> was mistakingly removed from <code>x</code> in the step preceding this one in the product. Will it throw an informativer error?</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">add_log_target</span>(mtcars)</a></code></pre></div>
<pre><code>## Error in log(x$target): non-numeric argument to mathematical function</code></pre>
<p>Uhh, no not exactly. Another of those R error beauties that will leave you clueless for a time. It is a good idea to check if all the columns that are required for the operations in the function are present before starting them. I use this little function,</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">df_has_cols &lt;-<span class="st"> </span><span class="cf">function</span>(x, cols, func) { </a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="kw">stopifnot</span>(<span class="kw">is.data.frame</span>(x))</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">all</span>(cols <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(x))) {</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    not_present &lt;-<span class="st"> </span><span class="kw">setdiff</span>(cols, <span class="kw">colnames</span>(x))</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="kw">stop</span>(<span class="kw">paste</span>(not_present, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot; missing from the data frame in function &quot;</span>, func[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"> }</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">}</a></code></pre></div>
<p>which is added to each function that uses a data frame</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">add_log_target &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="kw">df_has_cols</span>(x, <span class="st">&quot;target&quot;</span>, <span class="kw">match.call</span>())</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  x<span class="op">$</span>target_log &lt;-<span class="st"> </span><span class="kw">log</span>(x<span class="op">$</span>target)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  x</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw">add_log_target</span>(mtcars)</a></code></pre></div>
<pre><code>## Error in df_has_cols(x, &quot;target&quot;, match.call()): target missing from the data frame in function add_log_target</code></pre>
<p>(<code>match.call()</code> has to be added so it will return the name of the function that breaks for easy debugging).</p>
</div>
<div id="data-validation" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Data Validation</h3>
<p>Where the first two checks are about the structure of the inputs, data validation tests the assumptions to the data itself. Variables that cannot contain missing values, variables that must be strictly positive, or characters that can only take a limited number of values. If you have any such assumptions to your data, you do best to check them before you unleash your functions on it. You could use external packages such as <code>validate</code> or <code>recipes</code>, or you can write them yourself. The <code>stopifnot</code> function can be used to check any assumption you have, as long as you can create a single logical for it. In the above example, since we are taking the log of <code>target</code> and it is the target variable it must be strictly positive and nonmissing.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">add_log_target &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw">df_has_cols</span>(x, <span class="st">&quot;target&quot;</span>, <span class="kw">match.call</span>())</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="kw">stopifnot</span>(<span class="kw">all</span>(<span class="op">!</span><span class="kw">is.na</span>(x<span class="op">$</span>target)), <span class="kw">all</span>(x<span class="op">$</span>target <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  x<span class="op">$</span>target_log &lt;-<span class="st"> </span><span class="kw">log</span>(x<span class="op">$</span>target)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  x</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">}</a></code></pre></div>
</div>
</div>
<div id="unit-testing" class="section level2">
<h2><span class="header-section-number">7.2</span> Unit Testing</h2>
<ul>
<li>slow down - think through scenarios</li>
<li>externalise your memory</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="code-organsation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
